*&H100

'RANDOM BOOLEAN NETWORK SIMULATOR

SWAP 13 14
MOVE ;LIB_END 13 'SET UP SCREEN

>NEW
<GENERATE

>MAINLOOP
<DISPLAY
REFR
<STEP
BUTTON 9 'GET BUTTON
JEI 0 9 <MAINLOOP 'REPEAT UNTIL ONE IS PRESSED
;@CLS 'CLEAR THE SCREEN
REFR
;@BTN 'WAIT
;@X
JUMP <NEW 'RESET




>GENERATE 'SUBROUTINE TO GENERATE NEW NETWORK

PE &B1111

MOVE <TRUTH 0 'POINT TO TRUTH TABLE
MOVE 8 1 'LENGTH NEEDED
MOVE 1 2 'RANDOM BIT MASK
<FILL 'FILL IN RANDOM FIELDS

MOVE <NODES 0 'POINT TO TRUTH TABLE
MOVE 32 1 'LENGTH NEEDED
MOVE 1 2 'RANDOM BIT MASK
<FILL 'FILL IN RANDOM FIELDS

MOVE <LINKS 0 'POINT TO TRUTH TABLE
MOVE 96 1 'LENGTH NEEDED
MOVE 31 2 'RANDOM BIT MASK
<FILL 'FILL IN RANDOM FIELDS

EXIT &B1111

>FILL
JEI 0 1 <FILL_END 'IS FILLING OVER?
RND 3 'GENERATE RANDOMNESS
ANDR 2 3 = 'LIMIT IT USING BIT MASK
STORER 3 0 'WRITE TO TABLE
INC 0 'INCREMENT POINTER
DEC 1 'DECREMENT LENGTH
JUMP <FILL

>FILL_END
]

>DISPLAY 'SHOW NODES AS THEY CURRENTLY ARE
PE &B11
MOVE <NODES 0 'POINTER

>DLOOP
JEI <LINKS 0 <DEND 'END OF CELLS REACHED?
LOADR 0 1 'GET CELL
JEI 0 1 <DSPACE 'DISPLAY SPACE
I !îŠ— 'PRINT A BLOCK
;@PC
JUMP <DREPEAT

>DSPACE
I 32 'PRINT A SPACE
;@PC

>DREPEAT
INC 0 'INCREMENT POINTER
JUMP <DLOOP

>DEND
EXIT &B11

>STEP 'APPLY A SINGLE ITERATION OF THE NETWORK
PE &B111111
MOVE <NODES 0 'POINTER TO NODES
MOVE <LINKS 1 'POINTER TO LINKS
I 0
I 0 'SENTINEL STACK VALUE

>STEPLOOP 'CALCULATE NEXT GENERATION'S NODES
'R0=NODE POINTER
'R1=LINK TABLE POINTER
'R2=NODE VALUE
'R3=LINK COUNTER
'R4=LINK VALUE POINTER
'R5=STATE NUMBER
JEI <LINKS 0 <STEPWRITE 'EXIT?
LOADR 0 2 'GET CURRENT NODE VALUE
MOVE 3 3 'CREATE LINK COUNTER
MOVE 0 5 'RESET STATE NUMBER

>LINKLOOP 'GET LINKED NODE VALUES
JEI 0 3 <LINKEXIT 'DONE?
LOADR 1 4 'GET LINK
ADDI <NODES 4 = % 'CREATE POINTER
LOADR 4 = 'READ FROM POINTER
LEFTI 1 5 = % 'SHIFT STATE NUMBER
ADDR 4 5 = % 'ADD NEW STATE BIT
DEC 3 'DECREMENT COUNTER
INC 1 'INCREMENT POINTER
JUMP <LINKLOOP

>LINKEXIT
ADDI <TRUTH 5 = % 'CREATE POINTER TO NEW STATE
LOADR 5 = 'LOAD NEW STATE
JER 5 2 <LINKREPEAT 'DO NOTHING IF NODE DOES NOT CHANGE

S &B100001 'SEND NEW STATE AND CURRENT NODE
>LINKREPEAT
INC 0 'MOVE ONTO NEXT NODE
JUMP <STEPLOOP 'REPEAT

>STEPWRITE
REC &B11 'GET NEW NODE VALUES
'R0=NODE ADDRESS
'R1=NODE STATE
JEI 0 0 <STEPEXIT 'STEP FINISHED
STORER 1 0 'WRITE NODE
JUMP <STEPWRITE

>STEPEXIT
EXIT &B111111




'NETWORK
>TRUTH 'TRUTH TABLE FOR EVOLUTION
+8
>NODES '32 NODES
+32
>LINKS '3 NETWORK LINKS PER NODE
+96

